# 项目在k8s中启动失败

经排查日志，发现项目反复启动失败，并自动重启

------

项目终止时日志：

![](.\process_stop_log.png)

------

检查k8s pod 描述（`kubectl describe po podId`），发现退出码是143，非项目自动终止，而是k8s、docker、人为关闭：

![](.\k8s_exit_code.png)

------

再检查k8s pod 描述，发现提示健康检查接口调用被拒绝：

![](.\check_health_fail.png)

------

再检查日志，对比本地启动日志，未发现明显异常，发现服务器上项目每次启动3分钟左右容器就会被重启（此时项目未启动完成，本地环境启动一般30-40s）。怀疑是k8s健康检测时间小于项目启动时间，导致在每次项目未启动完成时，k8s调用项目健康检测接口失败，重启项目，进入死循环。找运维确认健康检测时间，把检测时间从3分钟调整到6分钟后，项目正常启动。

健康检测时间配置（`kubectl edit deploy deploymentId`）：

![](.\check_health_config.png)

此处配置为，pod启动后3分钟检测，每隔10s检测一次，2s未响应判为失败，失败3次后重启项目